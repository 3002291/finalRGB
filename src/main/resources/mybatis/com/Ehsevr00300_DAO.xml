<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.douzone.comet.service.eh.ehsevr.dao.Ehsevr00300_DAO">

	<select id="selectList" resultType="com.douzone.comet.service.eh.ehsevr.models.Ehsevr00300">
		SELECT 
			A.COMPANY_CD 
			, A.PLANT_CD 
			, B.PLANT_NM 
			, A.WT_SCSPL_CD  
			, A.WT_SCSPL_NM  
			, A.UNT_NM  
			, A.RMK_DC  
		FROM @{dzparam_dbname}EH_WTSUPPLY_MST A
		LEFT OUTER JOIN @{dzparam_dbname}MA_PLANT_MST B
		ON A.COMPANY_CD = B.COMPANY_CD 
			AND A.PLANT_CD = B.PLANT_CD 
		WHERE A.COMPANY_CD = #{P_COMPANY_CD}
		<if test='P_PLANT_CD != null and !"".equals(P_PLANT_CD)'>
			AND A.PLANT_CD = #{P_PLANT_CD}
		</if>
		<if test='P_WT_SCSPL_NM != null and P_WT_SCSPL_NM != ""'>
		AND (  UPPER(A.WT_SCSPL_NM) 	LIKE '%'||#{P_WT_SCSPL_NM}||'%' )
		</if>
	</select>
	
	<select id="mstDupCheck" resultType="int">
		SELECT COUNT(1) 
		FROM @{dzparam_dbname}EH_WTSUPPLY_MST 
		WHERE COMPANY_CD = #{company_cd}
			AND PLANT_CD = #{plant_cd} 
			AND WT_SCSPL_NM = (SELECT 
					MNG_DTL_NM 
				  FROM EH_CODE_DTL 
				  WHERE COMPANY_CD = #{company_cd}
					AND MCLS_CD = 'E0200'
					AND MNG_DTL_CD =#{wt_scspl_nm})
			AND UNT_NM = #{unt_nm} 
	</select>
	
	<select id="selectDrop1" resultType="com.douzone.comet.service.eh.ehsevr.models.Ehsevr00300Drop1">
		SELECT
			MNG_DTL_CD
			, MNG_DTL_NM 
		FROM @{dzparam_dbname}EH_CODE_DTL 
		WHERE COMPANY_CD = #{P_COMPANY_CD}
			AND MCLS_CD = 'E0200'
	</select>
	
	<insert id="insertEhsevr00300">
		INSERT INTO @{dzparam_dbname}EH_WTSUPPLY_MST (
				COMPANY_CD
				, PLANT_CD
				, WT_SCSPL_CD
				, WT_SCSPL_NM
				, UNT_NM
				, RMK_DC
				, INSERT_ID
				, INSERT_IP
				, INSERT_MCADDR_NM
				, INSERT_DTS
		) VALUES (
				#{company_cd}
				, #{plant_cd}
				, #{wt_scspl_nm}
				, (SELECT 
					MNG_DTL_NM 
				  FROM EH_CODE_DTL 
				  WHERE COMPANY_CD = #{company_cd}
					AND MCLS_CD = 'E0200'
					AND MNG_DTL_CD =#{wt_scspl_nm})
				, #{unt_nm}
				, #{rmk_dc}
				, #{P_INSERT_ID}
				, #{P_INSERT_IP}
				, #{P_INSERT_MCADDR_NM}
				, SYSDATE
		)
	</insert>
	
	<update id="updateEhsevr00300">		
		UPDATE	@{dzparam_dbname}EH_WTSUPPLY_MST
		SET		
			<if test='wt_scspl_nm neq null'> WT_SCSPL_NM = #{wt_scspl_nm}, </if>
			<if test='rmk_dc neq null'> RMK_DC = #{rmk_dc}, </if>
			UPDATE_ID = #{P_UPDATE_ID},
			UPDATE_IP = #{P_UPDATE_IP},
			UPDATE_MCADDR_NM = #{P_UPDATE_MCADDR_NM},
			UPDATE_DTS = SYSDATE
		WHERE	COMPANY_CD = #{company_cd}
			AND PLANT_CD = #{plant_cd} 
			AND WT_SCSPL_CD = #{wt_scspl_cd} 
			AND UNT_NM = #{unt_nm} 
	</update>
	
	
	<delete id="deleteEhsevr00300">
		DELETE
		FROM	@{dzparam_dbname}EH_WTSUPPLY_MST
		WHERE	COMPANY_CD = #{company_cd}
			AND PLANT_CD = #{plant_cd} 
			AND WT_SCSPL_CD = #{wt_scspl_cd} 
			AND UNT_NM = #{unt_nm} 
	</delete>
	
</mapper>
