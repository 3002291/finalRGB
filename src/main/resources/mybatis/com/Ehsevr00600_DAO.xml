<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.douzone.comet.service.eh.ehsevr.dao.Ehsevr00600_DAO">

	<select id="selectList" resultType="com.douzone.comet.service.eh.ehsevr.models.Ehsevr00600">		
		SELECT A.COMPANY_CD,
			   A.PLANT_CD,
			   A.CNT_ANAL_TRGT_CD,
			   A.CNT_ANAL_TRGT_NM,
			   A.MESR_CLAS_CD,
			   A.MESR_CLAS_NM,
			   A.BASE_UNIT_CD,
			   A.SQ_NO,
			   A.RMK_DC,
			   A.INSERT_ID,
			   A.INSERT_IP,
			   A.INSERT_MCADDR_NM,
			   A.INSERT_DTS,
			   A.UPDATE_ID,
			   A.UPDATE_IP,
			   A.UPDATE_MCADDR_NM,
			   A.UPDATE_DTS,
			   B.PLANT_NM

		  FROM @{dzparam_dbname}EH_WQANALCLAS_MST A
		  
		  LEFT OUTER JOIN @{dzparam_dbname}MA_PLANT_MST B
					   ON A.COMPANY_CD	= 	B.COMPANY_CD 
				      AND A.PLANT_CD 	= 	B.PLANT_CD

		 WHERE A.COMPANY_CD = #{P_COMPANY_CD}
		   AND (A.PLANT_CD = #{P_PLANT_CD} OR COALESCE(#{P_PLANT_CD}, ' ') = ' ')
		   AND UPPER(A.MESR_CLAS_NM) LIKE UPPER(CONCAT('%',CONCAT(#{P_MESR_CLAS_NM},'%'))) 	
	</select>

	<select id="ehsevr00600_e0400Ddl" resultType="com.douzone.comet.service.eh.ehsevr.models.Ehsevr00600">
		SELECT	MNG_DTL_CD CNT_ANAL_TRGT_CD, MNG_DTL_NM CNT_ANAL_TRGT_NM
		
		  FROM	@{dzparam_dbname}EH_CODE_DTL
		  
		 WHERE  COMPANY_CD = #{P_COMPANY_CD}
		   AND  MCLS_CD = 'E0400'
		 ORDER  BY MNG_DTL_CD 
	</select>
	
	<select id="ehsevr00600_e0500Ddl" resultType="com.douzone.comet.service.eh.ehsevr.models.Ehsevr00600">
		SELECT	MNG_DTL_CD MESR_CLAS_CD, MNG_DTL_NM MESR_CLAS_NM
		
		  FROM	@{dzparam_dbname}EH_CODE_DTL
		  
		 WHERE  COMPANY_CD = #{P_COMPANY_CD}
		   AND  MCLS_CD = 'E0500'
		 ORDER  BY MNG_DTL_CD 
	</select>
	
	<select id="mstDupCheck" resultType="Integer">
		SELECT COUNT(*)
		
          FROM @{dzparam_dbname}EH_WQANALCLAS_MST
           
         WHERE COMPANY_CD = #{company_cd}
           AND PLANT_CD = #{plant_cd}
           AND CNT_ANAL_TRGT_CD = #{cnt_anal_trgt_cd}
           AND MESR_CLAS_CD = #{mesr_clas_cd}
	</select>
	
	<delete id="deleteEhsevr00600">
		DELETE 
		  FROM @{dzparam_dbname}EH_WQANALCLAS_MST
		  
		 WHERE COMPANY_CD = #{company_cd}
 	       AND PLANT_CD = #{plant_cd}
 	       AND CNT_ANAL_TRGT_CD = #{cnt_anal_trgt_cd}
           AND MESR_CLAS_CD = #{mesr_clas_cd} 
	</delete>
	
	<update id="updateEhsevr00600">
		UPDATE @{dzparam_dbname}EH_WQANALCLAS_MST
		
	 	   SET RMK_DC = #{rmk_dc},
	 	   	   SQ_NO = #{sq_no}
	 	   
	 	 WHERE COMPANY_CD = #{company_cd}
	 	   AND PLANT_CD = #{plant_cd}
 	       AND CNT_ANAL_TRGT_CD = #{cnt_anal_trgt_cd}
           AND MESR_CLAS_CD = #{mesr_clas_cd}  
	</update>
	
	<insert id="insertEhsevr00600">
		INSERT INTO COMET.EH_WQANALCLAS_MST
		(	
			COMPANY_CD, 		PLANT_CD, 			CNT_ANAL_TRGT_CD, 		CNT_ANAL_TRGT_NM, 
			MESR_CLAS_CD, 		MESR_CLAS_NM, 		BASE_UNIT_CD, 			SQ_NO, 				RMK_DC, 
			INSERT_ID, 			INSERT_IP, 			INSERT_MCADDR_NM, 		INSERT_DTS, 
			UPDATE_ID, 			UPDATE_IP, 			UPDATE_MCADDR_NM, 		UPDATE_DTS
		)	SELECT	#{company_cd}, 		#{plant_cd}, 		#{cnt_anal_trgt_cd}, 	A.MNG_DTL_NM, 
					#{mesr_clas_cd}, 	B.MNG_DTL_NM, 	#{base_unit_cd}, 		#{sq_no}, 			#{rmk_dc}, 
					#{P_INSERT_ID},	#{P_INSERT_IP},	#{P_INSERT_MCADDR_NM},  SYSDATE,
					#{P_UPDATE_ID},	#{P_UPDATE_IP},	#{P_UPDATE_MCADDR_NM},  SYSDATE
					
			  FROM  @{dzparam_dbname} EH_CODE_DTL A
			  INNER JOIN @{dzparam_dbname} EH_CODE_DTL B
			          ON A.COMPANY_CD = B.COMPANY_CD
			         AND B.MCLS_CD = 'E0500'
			         AND B.MNG_DTL_CD = #{mesr_clas_cd}
			  WHERE A.COMPANY_CD = #{company_cd}
			    AND A.MCLS_CD = 'E0400'
			    AND A.MNG_DTL_CD = #{cnt_anal_trgt_cd}
	</insert>
</mapper>
